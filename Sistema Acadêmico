using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.IO;

namespace Sistema_Acadêmico_by_Lucas_and_Roger
{
    class Program
    {
        struct Aluno //estrutura do Aluno
        {
            public int Código;
            public string Nome;
        }
        struct Disciplina //estrutura da disciplina
        {
            public int Código;
            public string Nome, Sigla;
        }
        struct Nota
        {
            public string matéria;
            public string NomeAluno;
            public double NotaAluno;
        }

        static Disciplina[] Disciplinas = new Disciplina[5]; //vetor disciplina de no max 5 disciplinas
        static Aluno[] Alunos = new Aluno[40]; //vetor Aluno de no max 40 Alunos
        static Nota[] Notas = new Nota[200]; //vetor Nota de no max 200 Alunos
        static int qtdeD = 0, qtdeA = 0, qtdeN = 0;

        static void CarregarArquivos()
        {
            if (File.Exists("Disciplinas.txt") == true) // se arquivo existir, carregar
            {
                string[] linhas = File.ReadAllLines("Disciplinas.txt", Encoding.UTF8);
                for (int x = 0; x < linhas.Length; x++) // para cada linha do arquivo
                {
                    if (linhas[x].Trim().Length > 0)
                    {
                        string[] dadosDisciplinas = linhas[x].Split('|');
                        Disciplinas[qtdeD].Nome = dadosDisciplinas[0];
                        Disciplinas[qtdeD].Sigla = dadosDisciplinas[1];
                        Disciplinas[qtdeD].Código = Convert.ToInt16(dadosDisciplinas[2]);
                        qtdeD++;
                    }
                }

            }

            if (File.Exists("Alunos.txt") == true) // se arquivo existir, carregar
            {
                string[] linhas = File.ReadAllLines("Alunos.txt", Encoding.UTF8);
                for (int x = 0; x < linhas.Length; x++) // para cada linha do arquivo
                {
                    if (linhas[x].Trim().Length > 0)
                    {
                        string[] dadosAlunos = linhas[x].Split('|');
                        Alunos[qtdeA].Nome = dadosAlunos[0];
                        Alunos[qtdeA].Código = Convert.ToInt16(dadosAlunos[1]);
                        qtdeA++;
                    }
                }

            }
           
        }
        static string CarregarNotas(string conteudo)
        {
            qtdeN = 0;
            if (File.Exists("Notas.txt") == true) // se arquivo existir, carregar
            {
                string[] linhas = File.ReadAllLines("Notas.txt", Encoding.UTF8);
                for (int x = 0; x < linhas.Length; x++) // para cada linha do arquivo
                {
                    if (linhas[x].Trim().Length > 0)
                    {
                        string[] dadosNotas = linhas[x].Split('|');
                        Notas[qtdeN].matéria = dadosNotas[0];
                        Notas[qtdeN].NomeAluno = dadosNotas[1];
                        Notas[qtdeN].NotaAluno = Convert.ToDouble(dadosNotas[2]);
                        qtdeN++;
                        conteudo = (conteudo) + (Notas[qtdeN].matéria)+ "|"+(Notas[qtdeN].NomeAluno) + "|" +(Notas[qtdeN].NotaAluno) + Environment.NewLine;
                    }
                }

                return conteudo;

            }
            else
                conteudo = "";

            return conteudo;
        }


        //Parte Disciplina
        static void CadastrarDisciplinas() //cadastra a disciplina PS: Deichei Void pq por enquanto n estamos usando isso pra nada.
        {
            char resp;
            string conteudo = "";

            for (int i = qtdeD; i < Disciplinas.Length; i++)
            {
                do
                {
                    Console.WriteLine($"Digite o Nome da disciplina({i + 1}) (Max 5 disciplinas): ");
                    Disciplinas[i].Nome = Console.ReadLine().Trim();

                } while (Disciplinas[i].Nome.Length == 0 || Disciplinas[i].Nome.Length > 30);

                do
                {
                    Console.WriteLine($"Digite uma Sigla para a disciplina({i + 1}) (Max 4 caracteres): ");
                    Disciplinas[i].Sigla = Console.ReadLine().Trim();

                } while (Disciplinas[i].Sigla.Length == 0 || Disciplinas[i].Sigla.Length > 4);

                do
                {
                    bool verificar;
                    do
                    {
                        verificar = false;
                        try  //tente
                        {
                            Console.WriteLine($"Digite um Código para a disciplina({i + 1}) (Maior que 0): ");
                            Disciplinas[i].Código = Convert.ToInt16(Console.ReadLine().Trim()); //CUIDADO ELE CORTA OS 0 TB
                        }
                        catch  //se digitar algo sem ser int
                        {
                            Console.WriteLine("Por favor digite somente números inteiros !");
                            verificar = true;
                        }
                    } while (verificar == true);

                } while (Disciplinas[i].Código < 1);

                qtdeD++;

                if (qtdeD < Disciplinas.Length - 1)
                {
                    Console.WriteLine("Deseja cadastrar mais uma disciplina? (S/N)");
                    resp = Console.ReadLine().ToUpper().Trim()[0];
                }
                else
                    resp = 'N';

                if (resp == 'N')
                {
                    for (int t = 0; t < qtdeD; t++)
                        conteudo = Disciplinas[t].Nome + "|" + Disciplinas[t].Sigla + "|" + Disciplinas[t].Código + Environment.NewLine;

                    File.WriteAllText("Disciplinas.txt", conteudo, Encoding.UTF8);
                    break;
                }
            }
        }

        // Parte aluno
        static void CadastrarAlunos() //cadastra alunos PS: Deichei Void pq por enquanto n estamos usando isso pra nada.
        {
            char resp;
            string conteudo;

            for (int i = qtdeA; i < Alunos.Length; i++)
            {
                do
                {
                    Console.WriteLine($"Digite o Nome do Aluno({i + 1}) (Max 40 Alunos): ");
                    Alunos[i].Nome = Console.ReadLine().Trim();

                } while (Alunos[i].Nome.Length == 0 || Alunos[i].Nome.Length > 30);

                do
                {
                    bool verificar;

                    do
                    {
                        verificar = false;
                        try  //tente
                        {
                            Console.WriteLine($"Digite um Código para o Aluno({i + 1}) (Maior que 0): ");
                            Alunos[i].Código = Convert.ToInt16(Console.ReadLine().Trim());
                        }
                        catch  //se digitar algo sem ser int
                        {
                            Console.WriteLine("Por favor digite somente números inteiros !");
                            verificar = true;
                        }
                    } while (verificar == true);

                } while (Alunos[i].Código < 1);

                qtdeA++;

                if (qtdeA < Alunos.Length - 1)
                {
                    Console.WriteLine("Deseja cadastrar mais um Aluno? (S/N)");
                    resp = Console.ReadLine().ToUpper().Trim()[0];
                }
                else
                    resp = 'N';

                if (resp == 'N')
                {
                    for (int t = 0; t < qtdeA; t++)
                    {
                        conteudo = Alunos[t].Nome + "|" + Alunos[t].Código + Environment.NewLine;
                        File.AppendAllText("Alunos.txt", conteudo, Encoding.UTF8);
                    }
                    break;
                }

            }
        }

        //Lançar notas de acordo com a disciplina
        static void LançarNotasDisciplina()
        {
            string conteudo ="", disciplinaEncontrada = "",conteudos="";
            double Nota;
            bool verificador;
            int resposta = 0;

            Console.WriteLine("Dados carregados do arquivo:");
            if (File.Exists("Disciplinas.txt"))
            {

                for (int n = 0; n < qtdeD; n++)
                    Console.WriteLine($"{Disciplinas[n].Código} - {Disciplinas[n].Nome} - {Disciplinas[n].Sigla}");

                do
                {
                    verificador = false;
                    try
                    {
                        Console.WriteLine("Digite o código de uma disciplina: ");
                        resposta = Convert.ToInt16(Console.ReadLine());
                    }
                    catch
                    {
                        Console.WriteLine("Digite apenas números inteiros! ");
                        verificador = true;
                    }

                    for (int x = 0; x < qtdeD; x++)
                    {
                        if (resposta == Disciplinas[x].Código)
                        {
                            disciplinaEncontrada = Disciplinas[x].Nome;
                            verificador = false;
                            break;
                        }
                        else
                            verificador = true;
                    }

                } while (verificador == true);

                for (int i = qtdeN; i < qtdeA; i++)
                {
                    do
                    {
                        conteudos = CarregarNotas(conteudo);


                        verificador = false;
                        try
                        {
                            Console.WriteLine($"{Alunos[i].Código} - {Alunos[i].Nome} \nDigite uma nota para este aluno entre (0/10)");
                            Nota = Convert.ToDouble(Console.ReadLine());
                        }
                        catch
                        {
                            Console.WriteLine("Digite apenas números inteiros ou decimais!");
                            Nota = -1;
                        }

                        if (Nota >= 0 && Nota <= 10)
                        {
                            qtdeN++;
                            Console.WriteLine("Nota Cadastrada");
                            conteudos = conteudos + disciplinaEncontrada + "|" + Alunos[i].Nome + "|" + Nota + Environment.NewLine;
                        }
                        else
                        {
                            Console.WriteLine("Nota inválida tente novamente");
                            verificador = true;
                        }

                    } while (verificador == true);

                    File.WriteAllText("Notas.txt", conteudos, Encoding.UTF8);
                }
            }
        }
        static void Main(string[] args)
        {
            int resp = 0;
            bool verificar;

            CarregarArquivos();

            Console.WriteLine("Bem Vindo ao Sistema Acadêmico");

            do
            {
                do
                {
                    verificar = false;
                    try
                    {
                        Console.WriteLine("Oquê você deseja fazer? \n1- Cadastrar Disciplina \n2- Cadastrar aluno \n3- Lançar notas por disciplina \n4- Sair");
                        resp = Convert.ToInt16(Console.ReadLine().Trim());
                    }
                    catch
                    {
                        Console.WriteLine("Digite apenas numeros inteiros entre 1 e 4!");
                        verificar = true;
                    }
                } while (verificar == true);


                if (resp == 1)
                    CadastrarDisciplinas();
                else if (resp == 2)
                    CadastrarAlunos();
                else if (resp == 3)
                    LançarNotasDisciplina();



            } while (resp != 4);


            Console.ReadLine();
        }
    }
}

